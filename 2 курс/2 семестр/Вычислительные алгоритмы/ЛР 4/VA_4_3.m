clc;
clear;

x = [-0.6 -0.5 -0.3 -0.2 0 0.2];
y = sin(x);

%cs = spline(x,[cos(-0.6) y cos(0.2)]);
%xx_0 = linspace(-0.6, -0.5, 11);
%xx = linspace(-0.5, 0, 51);
%xx_n = linspace(0, 0.2, 21);
%yy_0 = linspace(cos(-0.6), cos(-0.6), 11);
%yy = spline(x,y,xx);
%yy_n = linspace(cos(0.2), cos(0.2), 21);
%plot(x,y,'--o',xx,ppval(cs,xx),'-');
%plot(x, y, 'o', xx_0, yy_0, xx, yy, xx_n, yy_n);

h = zeros(5:1);
for i = 1 : 5
    h(i) = x(i + 1) - x(i);
end
h_1 = h.^(-1);
h_2 = h.^(-2);

s_0 = cos(x(1));
s_5 = cos(x(6));

s = zeros(4:4);
r = zeros(4:1);

s(1, 1) = 2*(h_1(1) + h_1(2));
s(1, 2) = h_1(2);
r(1) = 3 * ( h_2(1) * ( y(2) - y(1) ) + h_2(2) * ( y(3) - y(2) ) ) - h_1(1) * s_0;

s(2, 1) = h_1(2);
s(2, 2) = 2*(h_1(2) + h_1(3));
s(2, 3) = h_1(3);
r(2) = 3 * ( h_2(2) * ( y(3) - y(2) ) + h_2(3) * ( y(4) - y(3) ) );

s(3, 2) = h_1(3);
s(3, 3) = 2*(h_1(3) + h_1(4));
s(3, 4) = h_1(4);
r(3) = 3 * ( h_2(3) * ( y(4) - y(3) ) + h_2(4) * ( y(5) - y(4) ) );

s(4, 3) = h_1(4);
s(4, 4) = 2*(h_1(4) + h_1(5));
r(4) = 3 * ( h_2(4) * ( y(5) - y(4) ) + h_2(5) * ( y(6) - y(5) ) ) - h_1(5) * s_5;

s
r
s_ = s\r'

syms X;
F_1(X) = ( X - x(2) ) ^ 2 * ( 2 * ( X - x(1) ) + h(1) ) * y(1) / (h(1) ^ 3) + ...
    ( X - x(1) ) ^ 2 * ( 2 * ( x(2) - X ) + h(1) ) * y(2) / (h(1) ^ 3) + ...
    ( X - x(2) ) ^ 2 * ( X - x(1) ) * s_0 / (h(1) ^ 2) + ...
    ( X - x(1) ) ^ 2 * ( X - x(2) ) * s_(1) / (h(1) ^ 2);
F_2(X) = ( X - x(3) ) ^ 2 * ( 2 * ( X - x(2) ) + h(2) ) * y(2) / (h(2) ^ 3) + ...
    ( X - x(2) ) ^ 2 * ( 2 * ( x(3) - X ) + h(2) ) * y(3) / (h(2) ^ 3) + ...
    ( X - x(3) ) ^ 2 * ( X - x(2) ) * s_(1) / (h(2) ^ 2) + ...
    ( X - x(2) ) ^ 2 * ( X - x(3) ) * s_(2) / (h(2) ^ 2);
F_3(X) = ( X - x(4) ) ^ 2 * ( 2 * ( X - x(3) ) + h(3) ) * y(3) / (h(3) ^ 3) + ...
    ( X - x(3) ) ^ 2 * ( 2 * ( x(4) - X ) + h(3) ) * y(4) / (h(3) ^ 3) + ...
    ( X - x(4) ) ^ 2 * ( X - x(3) ) * s_(2) / (h(3) ^ 2) + ...
    ( X - x(3) ) ^ 2 * ( X - x(4) ) * s_(3) / (h(3) ^ 2);
F_4(X) = ( X - x(5) ) ^ 2 * ( 2 * ( X - x(4) ) + h(4) ) * y(4) / (h(4) ^ 3) + ...
    ( X - x(4) ) ^ 2 * ( 2 * ( x(5) - X ) + h(4) ) * y(5) / (h(4) ^ 3) + ...
    ( X - x(5) ) ^ 2 * ( X - x(4) ) * s_(3) / (h(4) ^ 2) + ...
    ( X - x(4) ) ^ 2 * ( X - x(5) ) * s_(4) / (h(4) ^ 2);
F_5(X) = ( X - x(6) ) ^ 2 * ( 2 * ( X - x(5) ) + h(5) ) * y(5) / (h(5) ^ 3) + ...
    ( X - x(5) ) ^ 2 * ( 2 * ( x(6) - X ) + h(5) ) * y(6) / (h(5) ^ 3) + ...
    ( X - x(6) ) ^ 2 * ( X - x(5) ) * s_(4) / (h(5) ^ 2) + ...
    ( X - x(5) ) ^ 2 * ( X - x(6) ) * s_5 / (h(5) ^ 2);

hold on;
xx_1 = linspace(-0.6, -0.5, 11);
plot(xx_1, F_1(xx_1), '-r');
xx_2 = linspace(-0.5, -0.3, 21);
plot(xx_2, F_2(xx_2), '-r');
xx_3 = linspace(-0.3, -0.2, 11);
plot(xx_3, F_3(xx_3), '-r');
xx_4 = linspace(-0.2, 0, 21);
plot(xx_4, F_4(xx_4), '-r');
xx_5 = linspace(0, 0.2, 21);
plot(xx_5, F_5(xx_5), '-r');
xx = linspace(-0.6, 0.2, 81);
plot(xx, sin(xx), '--g');